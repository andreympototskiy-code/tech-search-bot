#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∑–∞–ø—É—Å–∫–∞ —Å–∏—Å—Ç–µ–º—ã –ø–æ–∏—Å–∫–∞ —Ç–µ—Ö–Ω–∏–∫–∏

echo "üöÄ –°–∏—Å—Ç–µ–º–∞ –ø–æ–∏—Å–∫–∞ —Ç–µ—Ö–Ω–∏–∫–∏"
echo "========================"

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ Python
if ! command -v python3 &> /dev/null; then
    echo "‚ùå Python3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Python3 –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è."
    exit 1
fi

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ pip
if ! command -v pip3 &> /dev/null; then
    echo "‚ùå pip3 –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ pip3 –¥–ª—è –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è."
    exit 1
fi

# –°–æ–∑–¥–∞–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
if [ ! -d "venv" ]; then
    echo "üì¶ –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
    python3 -m venv venv
fi

# –ê–∫—Ç–∏–≤–∏—Ä—É–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ
echo "üîß –ê–∫—Ç–∏–≤–∞—Ü–∏—è –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è..."
source venv/bin/activate

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
pip install -r requirements.txt

# –ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞–ª–∏—á–∏–µ .env —Ñ–∞–π–ª–∞
if [ ! -f .env ]; then
    echo "‚ö†Ô∏è  –§–∞–π–ª .env –Ω–µ –Ω–∞–π–¥–µ–Ω. –°–æ–∑–¥–∞—é –∏–∑ –ø—Ä–∏–º–µ—Ä–∞..."
    cp env_example.txt .env
    echo "üìù –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª .env, –¥–æ–±–∞–≤–∏–≤ —Ç–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ –∏ chat_id"
    echo "   –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞: –Ω–∞–ø–∏—à–∏—Ç–µ @BotFather –≤ Telegram"
    echo "   –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è chat_id: https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates"
    echo ""
    echo "–ù–∞–∂–º–∏—Ç–µ Enter –ø–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ .env —Ñ–∞–π–ª–∞..."
    read
fi

# –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
mkdir -p data

echo ""
echo "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º –∑–∞–ø—É—Å–∫–∞:"
echo "1) Telegram –±–æ—Ç (–ø–æ–∏—Å–∫ –ø–æ –∑–∞–ø—Ä–æ—Å—É)"
echo "2) –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å)"
echo "3) –†—É—á–Ω–æ–π –ø–æ–∏—Å–∫"
echo "4) –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è"
echo "5) –ü–æ–∫–∞–∑–∞—Ç—å –ø–æ–º–æ—â—å"
echo ""

read -p "–í–≤–µ–¥–∏—Ç–µ –Ω–æ–º–µ—Ä (1-5): " choice

case $choice in
    1)
        echo "ü§ñ –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞..."
        echo "   –ù–∞–ø–∏—à–∏—Ç–µ –±–æ—Ç—É '—á—Ç–æ –∏—â–µ–º' –∏–ª–∏ –æ–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞"
        echo "   –î–ª—è –æ—Å—Ç–∞–Ω–æ–≤–∫–∏ –Ω–∞–∂–º–∏—Ç–µ Ctrl+C"
        python main.py telegram-bot
        ;;
    2)
        echo "üåê –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞..."
        echo "   –í–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: http://localhost:5000"
        python main.py web
        ;;
    3)
        read -p "–í–≤–µ–¥–∏—Ç–µ –∑–∞–ø—Ä–æ—Å –¥–ª—è –ø–æ–∏—Å–∫–∞: " query
        if [ ! -z "$query" ]; then
            echo "üîç –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –ø–æ–∏—Å–∫–∞: $query"
            python main.py search --query "$query"
        else
            echo "‚ùå –ü—É—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å"
        fi
        ;;
    4)
        echo "üéØ –ó–∞–ø—É—Å–∫ –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏..."
        python demo.py
        ;;
    5)
        echo ""
        echo "üìñ –ü–æ–º–æ—â—å –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é:"
        echo ""
        echo "–ö–æ–º–∞–Ω–¥—ã:"
        echo "  python main.py telegram-bot            - –ó–∞–ø—É—Å–∫ Telegram –±–æ—Ç–∞"
        echo "  python main.py web                     - –ó–∞–ø—É—Å–∫ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞"
        echo "  python main.py search -q '–∑–∞–ø—Ä–æ—Å'      - –†—É—á–Ω–æ–π –ø–æ–∏—Å–∫"
        echo "  python demo.py                         - –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è"
        echo ""
        echo "–ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤:"
        echo "  'Apple iPhone 15 PRO 256gb'"
        echo "  'Samsung Galaxy S24 128gb'"
        echo "  'MacBook Air M2 256gb'"
        echo "  'PlayStation 5'"
        echo ""
        ;;
    *)
        echo "‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –≤—ã–±–æ—Ä"
        ;;
esac